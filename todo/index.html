<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="fast and easy to use todo lsit app">
    <meta name="theme-color" content="#333240"/>
    <title>todo-list</title>
    <link href='https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css' rel="stylesheet"/>
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<link rel="manifest" href="./manifest.json">

    
</head>
<body class="container" style='padding-top:0.5rem;'>
  
<script src="https://cdn.jsdelivr.net/gh/atoms19/dominity.js@latest/dist/dominity.min.js"></script>
<script>


//component task item
function TaskItem(task){
  return el('li').style({
      width:'100%',
      display:'flex',
      justifyContent:'space-between',
      alignItems:'center',
      padding:'0.5rem 1rem'
      
    }).
      _el('input','',{
        type:'checkbox',
          ariaLabel:'complete task'
       
      }).style({
        minWidth:'1.1rem'
      }).attr(task.done?('checked'):'unchecked','').checkFor('input',()=>{
        task.done=!task.done
        tasks.setProp('done',task.done)
        if(task.done){
          taskCompletionFeedBack()
        }
        
      })
      .$end().
      _el('span',task.name).style({
        textDecoration:task.done?'line-through':'none',
        opacity:task.done?'0.5':'1',
      }).onClick(()=>{
        MoreInfoItem(task) //model popup being triggered
      }).addChild(priorityTagItem(task.priority)).$end().
      _el('button',{ariaLabel:'close',title:"remove task"}).html(`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
    </svg>`).class('outline').style({
        padding:'0.3rem 0.52rem',
        display:'inline-flex',
        alignItems:'center',
        justifyContent:'center'
    }).onClick((s)=>{
 tasks.set(tasks.value.filter(ob=>{
   return ob!=task
 }))
      }).$end()

}


//tag

function priorityTagItem(p){
  let color='grey'
  switch (p){
    case 'alpha':
      color='#b52d58'
      break;
    case 'beta':
      color='#6466b0'
      break
    case 'gama':
      color="#997b53"
      break
    case 'sigma':
      color="#8d5399"


  }
  return el('div',p).style({
    backgroundColor:color,
    padding:'0.125rem 0.25rem',
    fontSize:'0.7rem',
    color:'rgba(0,0,0,0.7)',
    borderRadius:'0.3rem',
    fontWeight:'500',
    marginLeft:'0.5rem',
    display:color=='grey'?'none':'inline-flex'

  })
}


//modal pop up
function MoreInfoItem(task){
let content=reactable(task.note).as('s')
let priority=reactable(task.priority)
content.subscribe((d)=>{
    task['note']=d.value
    tasks.update()
})
content.update()
priority.subscribe((d)=>{
    task['priority']=d.value
    tasks.update()
})
priority.update()

let priorityTAGs=reactable(['no priority','alpha','beta','gama','sigma'])
return  el('dialog',{open:''}). 
      _el('article'). 
          _el('header'). 
            _el('button',{ariaLabel:'close',rel:'prev'}).onClick(s=>{
              s.parent().parent().parent().remove()
            }).$end(). 
            _el('p')._el('strong',`ðŸ“ ${task.name}`).$end()
            .$end()
          .$end().
      _el('textarea',{
          placeHolder:'type a note'
      }).style({
        height:'8rem'
      }).model(content).$end().
      _el('label','prority'). //dropdown
        _el('select',{name:'select',ariaLabel:'select priority'}).loops(priorityTAGs,(p,s,i)=>{
            s. 
              _el("option",p).$end()
          }).model(priority).$end()
      .$end().
      _el('span',`created on: ${task.createdOn}`).$end().
      _el('footer').$end(). 
  $end()
  

}

function taskCompletionFeedBack(){
  
  sound.play()
  
  setTimeout(()=>{
      sound.pause();
      sound.currentTime = 0;
    }, 700);

}


let introTasks=[{name:'welcome to todo ðŸŽ‰ðŸŽ‰',done:false,createdOn:'',note:'',priority:""},{name:'tap on a task to add notes/priority to itðŸ“',done:'',createdOn:'',note:"",priority:""}]

let sound=new Audio('./success.mp3')
let taskname=reactable('')
let tasks=reactable(localStorage.tasks?JSON.parse(localStorage.tasks):introTasks)
el('form').style({
  position:'fixed',
  bottom:'0.5rem',
  width:'100%',
    right:'0'
})
._el('fieldset',{
  role:'group'
}).
  _el('input',{
    type:'text',
      ariaLabel:'taskname field'
    ,placeHolder:'enter task'
    ,autocomplete:'off'
  }).model(taskname).$end().
  _el('input',{
    type:'submit',
    value:'add task'
  
  }).$end()
.$end().
checkFor('submit',(e)=>{
  e.preventDefault()
  if(taskname.value !=''){
    let currentDate=new Date()
    tasks.value.push({
      name:taskname.get(),
      done:false,
      createdOn:`${currentDate.toLocaleDateString('en-GB')}      ${currentDate.toLocaleTimeString('en-US')}`,
      note:'',
      priority:'no priority'
    })
    tasks.update()
    taskname.set('')   
  }
})

el('ul').style({
listStyle:'none',
padding:'0px',
paddingTop:'4rem',
  margin:'0px'
}).loops(tasks,(obj,p)=>{

  TaskItem(obj).addTo(p)
  
}).$end()


let noTaskMsg= el('hgroup').style({textAlign:'center',padding:'2rem'}).
_el('h5','you have no pending tasks').$end()
._el('p','add a new task by entering the name of task in the field above').$end()


//updating the localstorage each time tasks is updated
tasks.subscribe(()=>{
 
localStorage.tasks=JSON.stringify(tasks.value)


  noTaskMsg.showIf(tasks.value.length==0)


})
tasks.update()


  
</script>
</body>
</html>
